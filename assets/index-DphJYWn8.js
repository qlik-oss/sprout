import{r as o,j as t}from"./iframe-B4vjk2_C.js";import{u as B}from"./useControl-DPltlHoP.js";import{g as Z,S as q,a as X,b as ee}from"./SelectComposition-CjxfMaHc.js";import{t as A}from"./sprout-tokens-D9QRO1qB.js";import{F as te}from"./Close-CzhTZSOO.js";import{F as ae}from"./Edit-DrJZ1rCf.js";import{a as V,F as le}from"./Tooltip-D1n48xKC.js";import{K as N}from"./Menu-BL50xBAN.js";import{m as ne}from"./renderOrClone-D3fq_iUv.js";import{c as f}from"./classNames-DaRWzB8T.js";import{u as ie}from"./useI18n-DbSMZiRF.js";import{T as se}from"./icons-BjYZgjFf.js";import{A as oe}from"./AlertInline-DKFV__in.js";import{F as $}from"./FloatingWrapper-FR8zykZr.js";import{I as z}from"./IconButton-Ba8Tcb-S.js";import{T as re}from"./TagGroup-BD8-w4Bk.js";import{T as ce}from"./Tag-BK4gk7JG.js";import{T as ue}from"./TextField-BIeh6d0s.js";const fe="_value_edit_btn_wlya7_1",de="_value_clickable_wlya7_6",me="_value_container_wlya7_11",pe="_floating_container_wlya7_16",I={value_edit_btn:fe,value_clickable:de,value_container:me,floating_container:pe},P=o.forwardRef(H);function H({"aria-label":r,"aria-labelledby":u,editFocusSelector:m,errorMessages:_,showEditButton:S,showEditIcon:j,showFormButtons:y,view:v,editOffsetX:h=`calc(${A.common_spacing_m} * -1)`,editOffsetY:x=`calc(${A.common_spacing_s} * -1)`,edit:c,isEditing:p,isEditingDefault:k,onEdit:w,blurAction:b="save",onCancel:l,onSave:n,"data-testid":d,...a},s){const E=ie(),[F,g]=o.useState(void 0),[D,W]=o.useState(0),K=o.useRef(null),J=ne([K,s]),O=o.useRef(null),i=B({isEditing:p,isEditingDefault:k,onEdit:w},{onChangeKey:"onEdit",valueKey:"isEditing",defaultValueKey:"isEditingDefault"});o.useLayoutEffect(()=>{if(F==="view"){const e=K.current?.querySelectorAll(V);e&&e.length>0?(e[0].focus(),g(void 0)):K.current?.focus()}else if(F==="edit"){const e=O.current?.querySelectorAll(m||V);if(e&&e.length>0){const C=Array.from(e).filter(Q=>{const M=window.getComputedStyle(Q);return M.display!=="none"&&M.visibility!=="hidden"});C.length>0&&(C[0].focus(),g(void 0))}}},[F]);const T=o.useCallback(()=>{i.onChange(!1),b==="cancel"?l?.():n?.()},[i,l,n,b]);o.useEffect(()=>{const e=K.current?.getBoundingClientRect(),C=Math.floor(e?.height||0);D!==C&&W(C),i.value&&g("edit")},[i.value]);const L=(S||j)&&t.jsx(ae,{className:f("shrink-0","size-xl","border-box","text-default",I.value_edit_btn)});return t.jsx(le,{hideBackdrop:!0,className:f("flex","flex-row","w-full"),width:"reference",open:!!i.value,onOpenChange:(e,C)=>{if(e)i.onChange(!0);else switch(C){case"keypress-escape":break;case"click-outside":b==="cancel"?l?.():n?.(),i.onChange(!1,C);break;case void 0:throw new Error("Not implemented yet: undefined case");default:i.onChange(!1)}},content:t.jsxs("div",{className:f("bg-default","radius-subtle","absolute","flex","flex-col","gap-s","border-box","size-full","items-center"),"data-testid":d?`${d}.edit`:"edit",style:{inlineSize:`calc(100% - ${h} * 2)`,insetInlineStart:h,insetBlockStart:`calc(${D}px * -1 + ${x||"0px"})`},children:[t.jsx("form",{ref:O,className:f("flex","flex-row","border-box","w-full","h-fit","bg-default"),onSubmit:e=>{e.preventDefault(),e.stopPropagation(),i.onChange(!1,"submit"),n?.(),g("view")},onKeyDownCapture:e=>{e.key===N.TAB&&(!y||e.shiftKey)&&T(),e.key===N.ESCAPE&&(l?.(),g("view"),i.onChange(!1,"keypress-escape"))},children:typeof c=="function"?c():c}),t.jsxs("div",{className:f("flex","flex-row","border-box","w-full","items-start","gap-xl",I.floating_container),children:[t.jsx("div",{className:f("flex","flex-col","grow-1"),"data-target":!0,children:(_||[]).map(e=>t.jsx(oe,{severity:"error",title:e},e))}),y?t.jsxs("div",{className:f("flex","flex-row","items-start","gap-m"),children:[t.jsx($,{"data-target":!0,children:t.jsx(z,{"aria-label":E("inline-edit.cancel"),type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),l?.(),i.onChange(!1),g("view")},icon:t.jsx(te,{})})}),t.jsx($,{"data-target":!0,children:t.jsx(z,{type:"button","aria-label":E("inline-edit.save"),icon:t.jsx(se,{}),onKeyDownCapture:e=>{e.key===N.ESCAPE&&(i.onChange(!1),l?.(),g("view")),e.key===N.TAB&&(e.shiftKey||T())},onClick:e=>{e.preventDefault(),e.stopPropagation(),i.onChange(!1),n?.(),g("view")}})})]}):null]})]}),children:t.jsx("div",{className:f("relative","w-full","border-box",I.value_container),"data-testid":d,...a,children:t.jsxs("div",{...a,ref:J,"data-testid":d?`${d}.view`:"view",role:"button",tabIndex:0,onKeyDown:e=>{i.value||e.key==="Enter"&&(e.preventDefault(),i.onChange(!0))},onClick:e=>{i.value||(e.stopPropagation(),e.preventDefault(),i.onChange(!0))},className:f("flex","flex-row","items-center","gap-s","p-0","m-0","w-full","cursor-text","outline-focus-visible-centered","radius-pill",I.value_clickable),"aria-label":r,"aria-labelledby":u,children:[typeof v=="function"?v():v,L]})})})}H.displayName="InlineEdit.Primitive";function R({children:r}){return t.jsx("div",{className:f("font-label-s","text-weak"),children:r})}const ge=o.forwardRef(Y);function Y({"aria-label":r,"aria-labelledby":u,placeholder:m,isEditingDefault:_,isEditing:S,errorMessages:j,onSave:y,onCancel:v,showFormButtons:h,defaultValue:x,value:c,children:p,hasError:k,onChange:w,...b},l){const n=B({value:c,onChange:w,defaultValue:x},{onChangeKey:"onChange",valueKey:"value",defaultValueKey:"defaultValue",selector:s=>s.target.selectedOptions.map(E=>E.value)}),[d,a]=o.useState({});return o.useEffect(()=>{const s=Z(p,n.value);s&&a(s)},[p,n.value]),t.jsx(P,{"aria-label":r,"aria-labelledby":u,ref:l,editFocusSelector:'[role="combobox"]',isEditingDefault:_,isEditing:S,onSave:y,onCancel:()=>{v?.();const s={type:"change",target:{type:"select-multiple",value:"",selectedOptions:(x||c||[]).map(E=>({value:E}))}};n.onChange(s,"cancel")},showFormButtons:h,errorMessages:j,...b,view:t.jsxs(re,{children:[(n.value||[]).map(s=>t.jsx(ce,{text:X(d,s),size:"s"},s)),(n.value||[]).length===0&&!!m&&t.jsx(R,{children:m})]}),edit:t.jsx(q.Multi,{hideBackdrop:!0,hasError:k,"aria-label":r,"aria-labelledby":u,placeholder:m,value:n.value,onChange:s=>{n.onChange(s)},children:p})})}Y.displayName="InlineEdit.MultiSelect";const ve=o.forwardRef(G);function G({"aria-label":r,placeholder:u,isEditingDefault:m,isEditing:_,errorMessages:S,onSave:j,onCancel:y,showFormButtons:v,defaultValue:h,value:x,children:c,onChange:p,hasError:k,...w},b){const l=B({value:x,onChange:p,defaultValue:h},{onChangeKey:"onChange",valueKey:"value",defaultValueKey:"defaultValue",selector:a=>a?.target?.value}),[n,d]=o.useState({children:""});return o.useEffect(()=>{const a=ee(c,l.value);a&&d(a)},[c,l.value]),t.jsx(P,{"aria-label":r,ref:b,editFocusSelector:'[role="combobox"]',isEditingDefault:m,isEditing:_,onSave:j,onCancel:()=>{y?.();const a={type:"change",target:{type:"select-one",value:h||x||"",selectedOptions:[]}};l.onChange(a,"cancel")},showFormButtons:v,errorMessages:S,...w,view:t.jsx("div",{className:f("overflow-hidden","w-full","break-words","text-default","text-start"),children:n.children||l.value||t.jsx(R,{children:u||""})}),edit:t.jsx(q.Select,{hideBackdrop:!0,"aria-label":r,defaultOpen:!0,placeholder:u,value:l.value,onChange:a=>{l.onChange(a)},hasError:k,children:c})})}G.displayName="InlineEdit.Select";function he({children:r,font:u}){return t.jsx("span",{className:f(`font-${u||"label-s"}`,"text-default","text-start","truncate"),style:{whiteSpace:"pre"},children:r})}const xe=o.forwardRef(U);function U({"aria-label":r,"aria-labelledby":u,placeholder:m,isEditingDefault:_,isEditing:S,errorMessages:j,onSave:y,onCancel:v,hasError:h,showFormButtons:x,defaultValue:c,value:p,view:k=he,font:w,type:b,onChange:l,...n},d){const a=B({value:p,defaultValue:c,onChange:l},{valueKey:"value",defaultValueKey:"defaultValue",onChangeKey:"onChange",selector:F=>F.target.value}),s=k,E=t.jsx(s,{font:w,children:a.value||t.jsx(R,{children:m})});return t.jsx(P,{"aria-label":r,"aria-labelledby":u,ref:d,isEditingDefault:_,isEditing:S,onSave:y,onCancel:()=>{v?.(),a.onChange({target:{value:c||p}},"cancel")},showFormButtons:x,errorMessages:j,...n,view:E,edit:t.jsx(ue,{"aria-label":r,"aria-labelledby":u,placeholder:m,value:a.value,font:w||"label-s",hasError:h,type:b,onChange:(F,g)=>{a.onChange(F,g)}})})}U.displayName="InlineEdit.TextField";const Te={Primitive:P,TextField:xe,Select:ve,MultiSelect:ge};export{Te as I};
