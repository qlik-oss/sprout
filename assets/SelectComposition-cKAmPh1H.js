import{r,j as i}from"./iframe-BQJExRCF.js";import{s as I}from"./sprout-DxA14K3u.js";import{u as Z}from"./useControl-XJuj1vyK.js";import{K as F,m as pe,a as Ve,M as he}from"./Menu-D_upy4ds.js";import{g as se,P as oe}from"./list-B1zo5gaH.js";import{m as Oe}from"./renderOrClone-DAgGzV0n.js";import{u as re}from"./useI18n-B99T9obj.js";import{F as ve}from"./Error-B95qseKK.js";import{D as Ie}from"./icons-CzMI2h-K.js";import{F as Se,T as qe}from"./Tooltip-CVFOQrqK.js";import{I as He}from"./InputButton-CeEVJl7G.js";import{T as $e}from"./TagGroup-BsZ4uWAl.js";import{T as Ge}from"./Tag-DLmRXsBI.js";import{u as we}from"./useFieldProps-C0xARZ1e.js";import{F as Ee}from"./Field-BIldF_Al.js";import{F as We}from"./Add-CPO6AOva.js";import{c as ce}from"./classNames-B0wfWtWT.js";import{u as Ae}from"./useId-Drz8gmS2.js";import{T as ze}from"./TextField-C-5GsH-r.js";const J="data-hovered";class Ne{isOpen;onOpenChange;onChange;element;name;value;listbox;getAllItems;_getAllItems;getSelectedItems;_getSelectedItems;loop;onSelect;constructor(e){this.isOpen=e.isOpen,this.name=e.name,this.value=e.value,this.onOpenChange=e.onOpenChange,this.onChange=e.onChange,this.getAllItems=e.getAllItems,this.getSelectedItems=e.getSelectedItems,this.loop=e.loop===void 0?!0:e.loop,this._getSelectedItems=()=>this.listbox&&this.getSelectedItems?this.getSelectedItems(this.listbox):se(),this._getAllItems=()=>this.listbox?this.getAllItems(this.listbox):se(),this.onSelect=e.onSelect,this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}setElement(e){this.element=void 0,e&&(this.element=e)}setListbox(e){this.listbox=void 0,e&&(this.listbox=e)}setIsIOpen(e){this.isOpen=e}setValue(e){this.value=e}getListInfo(){const e={selected:se(),all:se(),focus:void 0,focusIndex:-1,lastIndex:-1};if(!this.element)return e;e.all=this._getAllItems(),e.selected=this._getSelectedItems(),e.lastIndex=e.all.length-1;const s=e.all.values();let t,o=-1;do{const{value:a,done:d}=s.next();o+=1,t=!d,a&&(a.getAttribute(J)==="true"?(e.focus=a,e.focusIndex=o):a.setAttribute(J,"false"))}while(t);return e}focusOnNextItem(){const e=this.getListInfo();if(e.focusIndex===-1){this.focusOn(e,0);return}e.focusIndex===e.lastIndex?this.loop&&this.focusOn(e,0):typeof e.focusIndex=="number"&&this.focusOn(e,e.focusIndex+1)}focusOnPreviousItem(){const e=this.getListInfo();if(e.focusIndex===-1){this.focusOn(e,0);return}e.focusIndex===0?this.loop&&this.focusOn(e,e.lastIndex):this.focusOn(e,e.focusIndex-1)}focusOnNextPageItem(){const e=this.getListInfo();e.focusIndex+oe>=e.lastIndex?this.focusOn(e,e.lastIndex):this.focusOn(e,e.focusIndex+oe)}focusOnPreviousPageItem(){const e=this.getListInfo();e.focusIndex-oe<0?this.focusOn(e,0):this.focusOn(e,e.focusIndex-oe)}focusOnFirst(){const e=this.getListInfo();this.focusOn(e,0)}focusOnLast(){const e=this.getListInfo();this.focusOn(e,e.lastIndex)}resetFocus(){this._getAllItems().forEach(s=>{s.setAttribute(J,"false")})}focusOn(e,s){if(s<0||s>e.lastIndex)return;const t=e.all[s];t&&(t.setAttribute(J,"true"),Ue(t)||setTimeout(()=>{if(t.isConnected){const o=t.closest('[role="listbox"]');if(o){const a=t.getBoundingClientRect(),d=o.getBoundingClientRect(),l=a.top-d.top,u=a.bottom-d.top,c=d.height;let h=o.scrollTop;l<0?h+=l:u>c&&(h+=u-c),o.scroll({top:Math.max(0,h),behavior:"smooth"})}}},10),this.onChange(t),e.focusIndex!==-1&&e.focusIndex!==s&&e.all[e.focusIndex].setAttribute(J,"false"),e.focusIndex=s)}focusOnFirstSelected(){const e=this.getListInfo(),s=e.selected[0];if(s){const t=Array.from(e.all).indexOf(s);this.focusOn(e,t)}else this.focusOn(e,0)}onKeyDownHandler(e){switch(e.key){case F.TAB:this.isOpen&&this.onOpenChange(!1);break;case"Down":case F.DOWN:e.stopPropagation(),e.preventDefault(),this.isOpen?this.focusOnNextItem():this.onOpenChange(!0);break;case"Up":case F.UP:e.stopPropagation(),e.preventDefault(),this.focusOnPreviousItem();break;case F.HOME:e.stopPropagation(),e.preventDefault(),this.focusOnFirst();break;case F.END:e.stopPropagation(),e.preventDefault(),this.focusOnLast();break;case F.PAGE_DOWN:e.stopPropagation(),e.preventDefault(),this.focusOnNextPageItem();break;case F.PAGE_UP:e.stopPropagation(),e.preventDefault(),this.focusOnPreviousPageItem();break}}}function Ue(n){const e=n.closest('[role="listbox"]');if(!e)return!0;const s=n.getBoundingClientRect(),t=e.getBoundingClientRect(),o=s.top-t.top,a=s.bottom-t.top;return o>=0&&a<=t.height}class Ye extends Ne{constructor(e){super(e),this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}onKeyDownHandler(e){switch(e.key){case F.ENTER:{if(e.stopPropagation(),e.preventDefault(),!this.isOpen)this.onOpenChange(!0);else{const t=this.getListInfo().focus;if(t){const o={type:"change",target:{type:"select-one",name:this.name,value:t.dataset.option}};this.onSelect?.(o)}this.onOpenChange(!1),this.element?.focus()}break}case F.ESCAPE:if(this.isOpen)e.stopPropagation(),this.onOpenChange(!1),this.element?.focus();else if(this.value){const s={type:"change",target:{type:"select-one",name:this.name,value:this.value}};this.onSelect?.(s)}break}super.onKeyDownHandler(e)}}function Je(n,e){const s=document.documentElement,o=window.getComputedStyle(s).getPropertyValue(n);if(o)return o.replace(/['"]/g,"").trim()}function Qe(n,e){const s=Je(n);if(s===void 0)return;const t=parseInt(s,10);return Number.isNaN(t)?void 0:t}function _e(n){if(!n)return n;const e=n.lastIndexOf("(");if(e===-1)return n;const s=n.slice(e+1),t=s.indexOf(")");return t!==-1?s.slice(0,t):s}function fe(n,e){if(!n)return{};let s=n;return Array.isArray(n)||(s=[n]),s.reduce((t,o)=>{if(t.value||!o||typeof o!="object")return t;if(Array.isArray(o))return{...fe(o,e),...t};if(!o.props)return t;if(_e(o.type.displayName)!=="Option"){if(o.props.children){const a=fe(o.props.children,e);if(a.value!==void 0)return a}}else if(e===o.props.value||!e&&o.props.value==="")return o.props;return t},{})}function de(n,e){if(!n)return{};let s=n;return Array.isArray(n)||(s=[n]),s.reduce((t,o)=>{if(!o||typeof o!="object")return t;if(Array.isArray(o))return{...de(o,e),...t};if(!o.props)return t;if(_e(o.type.displayName)!=="Option"){if(o.props.children)return{...de(o.props.children,e),...t}}else e?.includes(o.props.value||"")&&(t[o.props.value||""]=o.props);return t},{})}function Xe(n,e){let s=e;const t=n[e]?.children;switch(typeof t){case"string":s=t;break;case"object":s=t.props.label;break;default:s=e;break}return s}const Ze="_input_njiq0_1",et="_small_njiq0_7",ge={input:Ze,small:et},tt=r.forwardRef(De);function De({size:n,hasError:e,readOnly:s,isOpen:t,"aria-controls":o,placeholder:a,disabled:d,value:l,onClick:u,renderValue:c,children:h,...O},p){const[x,g]=r.useState({children:""});return r.useEffect(()=>{const C=fe(h,l);C&&g(C)},[h]),i.jsxs("button",{role:"combobox",type:"button",...O,"aria-readonly":s?"true":"false",disabled:d,"aria-controls":o,"aria-expanded":t?"true":"false",ref:p,className:I.classNames("flex-noreset","border-box","w-full","m-0","text-start","gap-m","justify-start","border-moderate","radius-pill","outline-focus-visible-centered",ge.input,{[ge.small]:n==="small","cursor-pointer":!d,"cursor-not-allowed":!!d,border_error:!!e,"bg-interactive":!s&&!t,"bg-disabled":!!s,"bg-pressed":!!t}),onClick:C=>{if(!d&&!s&&u&&u(C),s){const N=C.currentTarget.querySelector('[data-testid="selected-value"]');if(N){const w=document.createRange(),E=window.getSelection();E&&(E.removeAllRanges(),w.selectNodeContents(N),E.addRange(w))}}},children:[!!l&&!!c&&i.jsx("span",{"data-testid":"selected-value",className:I.classNames("flex-1","border-box","truncate","pr-m","w-full","text-default","font-label-s","pointer-events-none"),children:c(l,x)}),!!l&&!c&&i.jsx("div",{"data-testid":"selected-value",className:I.classNames("overflow-hidden","w-full","truncate","text-default","font-label-s"),children:x.children}),!l&&i.jsx("span",{className:I.classNames("flex-noreset","pr-m","text-weak","font-label-s","w-full"),children:a}),!!e&&i.jsx(ve,{"data-icon":"error",width:void 0,height:void 0,className:I.classNames("shrink-0","text-danger","self-center",{"size-xl":n!=="small","size-l":n==="small"})}),i.jsx(Ie,{className:I.classNames("fill-default","shrink-0","self-center",{"fill-disabled":!!d||!!s})})]})}De.displayName="Combobox";const W=r.createContext({}),nt=(n,e)=>e===void 0||!n?!1:Array.isArray(n.value)?n.value.includes(e):n.value===e;function ae(){const n=re(),{queryFilter:e,setQueryFilter:s,open:t,onKeyDownCapture:o}=r.useContext(W),a=r.useRef(null),[d,l]=r.useState(void 0);return r.useEffect(()=>{t&&setTimeout(()=>{a.current&&a.current.focus()})},[t]),r.useEffect(()=>{setTimeout(()=>{if(e){const c=document.querySelector('[role="listbox"]')?.querySelectorAll('button[data-option]:not([aria-hidden="true"])');l(c?.length)}else l(void 0)})},[e]),i.jsxs(i.Fragment,{children:[i.jsx("span",{className:I.classNames("mb-s"),children:i.jsx(ze,{ref:a,type:"search",role:"searchbox",placeholder:n("select.dropdown.search.placeholder"),value:e,onChange:u=>s?.(u.target.value),onKeyDownCapture:o})}),!!e&&d===0&&i.jsx("div",{role:"status",className:I.classNames("p-m","font-label-s","text-weak"),"aria-live":"polite",children:n("select.dropdown.no-results.message")})]})}ae.displayName="SelectSearch";const st='button[data-option]:not([disabled]):not([aria-hidden="true"])',ot='button[aria-selected="true"]:not([disabled]):not([aria-hidden="true"])';function je(n){return n.querySelectorAll(st)}function Fe(n){return n.querySelectorAll(ot)}const X=({name:n,value:e,values:s,action:t})=>{const o={type:"change",target:{name:n,value:e,type:"select-multiple",selectedOptions:(s||[]).map(a=>({value:a}))}};return t==="add"&&e?(s||[]).find(a=>a===e)||(o.target.selectedOptions=o.target.selectedOptions?.concat({value:e})):t==="remove"&&(o.target.selectedOptions=o.target.selectedOptions?.filter(a=>a.value!==e)),o},rt=500,xe=new WeakMap;function be(n){let e=xe.get(n);return e||(e={buffer:"",timerId:null,selectedValue:null},xe.set(n,e)),e}function Re(n){n.timerId!==null&&typeof window<"u"&&(window.clearTimeout(n.timerId),n.timerId=null)}function at(n){Re(n),!(typeof window>"u")&&(n.timerId=window.setTimeout(()=>{n.buffer="",n.timerId=null,n.selectedValue=null},rt))}function ye(n,e,s){if(!e||n.length===0)return-1;const t=n.length;if(typeof s>"u"||s<0){for(let o=0;o<t;o++)if(n[o].startsWith(e))return o;return-1}for(let o=1;o<=t;o++){const a=(s+o)%t;if(n[a].startsWith(e))return a}return-1}function Ce(n,e,s){const t=n.length;if(!t||!e)return-1;let o=-1,a=null,d=-1,l=null;const u=c=>{const h=n[c].charAt(0);h&&((a===null||h<a)&&(a=h,o=c),h>=e&&(l===null||h<l)&&(l=h,d=c))};if(typeof s>"u"||s<0)for(let c=0;c<t;c++)u(c);else for(let c=1;c<=t;c++)u((s+c)%t);return d!==-1?d:o}function lt(n){r.useEffect(()=>()=>{s(n)},[]);const e=({typedCharacter:t,open:o,onChange:a,name:d})=>{const l=n.current;if(!l)return;const u=be(l),c=t.toLowerCase();u.buffer+=c,at(u);const h=Array.from(l._getAllItems());if(!h.length)return;const O=h.length,p=h.map(E=>E.textContent.trim().toLowerCase()),x=u.buffer;if(!x||!O)return;if(!o){const E=ye(p,x);if(E!==-1){u.selectedValue=h[E].getAttribute("data-option");const v={type:"change",target:{type:"select-one",name:d,value:u.selectedValue||"",selectedOptions:[]}};a(v);return}const K=Ce(p,x[0]);u.selectedValue=K!==-1?h[K].getAttribute("data-option"):null;const R={type:"change",target:{type:"select-one",name:d,value:u.selectedValue||"",selectedOptions:[]}};a(R);return}const g=l.getListInfo();if(!g)return;const C=g.focusIndex,N=ye(p,x,C);if(N!==-1){l.focusOn(g,N);return}const w=Ce(p,x[0],C);w!==-1&&l.focusOn(g,w)};function s(t){const o=t?.current;if(!o)return;const a=be(o);a.buffer="",Re(a)}return{onKeydown:e,resetTypeahead:s}}const it=Qe("--sprout-common-spacing-xxl")||24,ut=r.forwardRef(ke);function ct(n){const[e,...s]=r.Children.toArray(n);return r.isValidElement(e)&&e.type===ae?i.jsxs(i.Fragment,{children:[e,i.jsx("div",{className:ce("overflow-auto"),role:"listbox",tabIndex:-1,children:s})]}):n}function ke({children:n,defaultOpen:e,defaultValue:s,disabled:t,disableScrollLock:o,hasError:a,hideBackdrop:d,id:l,maxWidth:u,name:c,onChange:h,onOpenChange:O,open:p,placeholder:x,placementUpdate:g,readOnly:C,size:N,value:w,...E},K){const R=Ae(l),[v,L]=r.useState(!1),[z,U]=r.useState(""),[V,k]=r.useState(""),Y=`${R}-listbox`,P=r.useRef(null),b=r.useRef(null),ee=r.useMemo(()=>{const[m]=r.Children.toArray(n);return r.isValidElement(m)&&m.type===ae},[n]),y=m=>{setTimeout(()=>{h&&h(m)})},S=Z({value:w,onChange:y,defaultValue:s},{selector:m=>m?.target?.value}),_=r.useCallback(m=>{if(m){const $=m.getAttribute("id");$&&U($)}},[]),A=r.useRef(new Ye({name:c,getAllItems:je,getSelectedItems:Fe,isOpen:p,onOpenChange:O,onChange:_,onSelect:m=>{S.onChange(m),y(m)}}));r.useEffect(()=>{A.current.setIsIOpen(p),p||k(""),b.current&&p&&b.current.focus()},[p]),r.useEffect(()=>{p&&P.current&&(S.value===void 0?A.current.focusOnFirst():A.current.focusOnFirstSelected())},[p,P,S.value]),r.useEffect(()=>{A.current.setValue(S.value)},[S.value]);const{onKeydown:q,resetTypeahead:B}=lt(A),T=r.useCallback(m=>{m.key.length===1&&!m.ctrlKey&&!m.metaKey&&!m.altKey&&m.key!==" "&&q({typedCharacter:m.key,open:p,onChange:S.onChange}),A.current.onKeyDownHandler(m),B()},[p,q,B,S.onChange]),le=r.useMemo(()=>({queryFilter:V||"",setQueryFilter:k,value:S.value,open:p,onKeyDownCapture:T}),[S.value,V,k,p,T]),D=i.jsx(W.Provider,{value:le,children:ct(n)});P.current&&A.current.setListbox(P.current),b.current&&A.current.setElement(b.current);const H=r.useRef(null),ie=Oe([H,K]);return r.useEffect(()=>{const m=H.current?.value;s===void 0&&w===void 0&&m&&S.onChange({type:"change",target:H.current})},[s,w,H]),i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"hidden",defaultValue:s,value:s?void 0:S.value,name:c,ref:ie}),i.jsx(Se,{disableScrollLock:o,hideBackdrop:d,initialOpen:e,open:v?p:!1,onOpenChange:O,anchorEl:b.current||void 0,forceMount:!0,onMount:()=>{L(!0)},minWidth:"reference",maxWidth:u||"s",minHeight:100,viewportPadding:it,placementUpdate:g===void 0?"dropdown":g,id:Y,className:pe.menu,"aria-labelledby":R,ref:P,role:ee?void 0:"listbox",tabIndex:-1,onClick:m=>{const te=m.target.closest("button[data-option]");if(!te)return;O(!1);const ne={type:"change",target:{type:"select-one",name:c,value:te.dataset.option}};S.onChange(ne)},content:D}),i.jsx(tt,{...E,hasError:a,"aria-activedescendant":z,placeholder:x,isOpen:p,size:N,value:S.value,id:R,"aria-controls":Y,disabled:t,readOnly:C,ref:b,onClick:()=>{O(!p)},onKeyDownCapture:T,children:D})]})}ke.displayName="SelectFloating";const ft=r.forwardRef(Pe);function Pe({isError:n,defaultOpen:e,disableScrollLock:s,hideBackdrop:t,selectedValueDisplay:o="full",...a},d){const[l,u]=r.useState(!!e),{fieldProps:c,inputProps:h,useField:O}=we(a);let p=i.jsx(ut,{"data-selected-value-display":o,ref:d,disableScrollLock:s,hideBackdrop:t,...h,hasError:n||h.hasError,defaultOpen:e,open:l,onOpenChange:u});return O&&(p=i.jsx(Ee,{...c,isError:n||h.hasError,onKeyDownCapture:x=>{const g=x.key===F.TAB,C=x.shiftKey&&g;(g||C)&&l&&u(!1)},children:p})),p}Pe.displayName="Select";class dt extends Ne{constructor(e){super(e),this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}onKeyDownHandler(e){switch(e.key){case F.ENTER:{e.stopPropagation(),e.preventDefault();const t=this.getListInfo().focus;if(t){const o=t.dataset.option,a=t.getAttribute("aria-selected")==="true",d=X({name:this.name,value:o,values:this.value,action:a?"remove":"add"});this.onSelect?.(d)}break}}super.onKeyDownHandler(e)}}const pt="_input_175ug_1",ht="_input_disabled_175ug_20",mt="_input_error_175ug_26",gt="_input_readonly_175ug_43",xt="_search_input_175ug_49",Q={input:pt,input_disabled:ht,input_error:mt,input_readonly:gt,search_input:xt},bt=r.forwardRef(Te);function Te(n,e){const{id:s,type:t,values:o,renderValues:a,children:d,disabled:l,readOnly:u,hasError:c,value:h,onChange:O,defaultValue:p,onClear:x,labelClear:g,"data-testid":C,"aria-labelledby":N,"aria-label":w,...E}=n,R=re()("select.comboboxeditable.clear"),v=r.useRef(null),L=Z({value:h,onChange:O,defaultValue:p},{onChangeKey:"onChange",valueKey:"value",defaultValueKey:"defaultValue",selector:k=>k.target.value}),[z,U]=r.useState({});r.useEffect(()=>{const k=de(d,o);U(k)},[d,o]);const V=!u&&o||!o?i.jsx("input",{...E,"aria-label":w,id:s,value:L.value,onChange:L.onChange,type:t||"text",disabled:l||u,readOnly:u,className:I.classNames("relative","flex-noreset","flex-1","border-none","bg-transparent","text-default","font-label-s","py-s","px-xs","outline-none",Q.search_input,{"cursor-text":!l,"cursor-not-allowed":!!l}),ref:v}):null;return i.jsxs("div",{className:I.classNames("border-box","box-shadow-transparent","flex-noreset","flex-row","items-center","justify-stretch","w-full","relative","border-moderate","radius-pill","bg-default","overflow-hidden",Q.input,{[Q.input_error]:!!c,[Q.input_readonly]:!!u,[Q.input_disabled]:!!l}),"data-testid":C,ref:e,onClick:()=>{v.current&&v.current.focus()},children:[i.jsx("button",{type:"button",className:I.classNames("absolute","bg-transparent","outline-none","border-none","w-full","h-full","p-0","m-0","left-0","top-0",{"cursor-pointer":!l,"cursor-not-allowed":!!l}),onClick:()=>{l||u||v.current&&v.current.focus()},"aria-labelledby":N,"aria-label":w}),a(o||[],z,V),!!x&&!u&&!l&&i.jsx(qe,{title:g||R,children:i.jsx(He,{"data-clear":"true",id:`${s}-clear`,onClick:()=>{L.onChange({target:{value:""}}),x(),v.current&&v.current.focus()},"aria-label":g||R,size:"s"})}),!!c&&i.jsx(ve,{width:void 0,height:void 0,className:I.classNames("self-center","size-xl","shrink-0","mr-m","text-danger")}),i.jsx(Ie,{className:I.classNames("fill-default","shrink-0","self-center",{"fill-disabled":!!l||!!u})})]})}Te.displayName="ComboboxEditable";const yt=()=>{},Ct=n=>{const e=[],s=t=>{r.isValidElement(t)&&(t.props&&typeof t.props=="object"&&"value"in t.props&&typeof t.props.value=="string"&&e.push(t.props.value),t.props&&typeof t.props=="object"&&"children"in t.props&&t.props.children&&(typeof t.props.children=="string"||typeof t.props.children=="number"||typeof t.props.children=="boolean"||Array.isArray(t.props.children)||r.isValidElement(t.props.children))&&r.Children.forEach(t.props.children,s))};return r.Children.forEach(n,s),e},Ot=r.forwardRef(Ke);function Ke({"data-testid":n,children:e,defaultOpen:s,defaultValue:t,disabled:o,disableScrollLock:a=!1,filterValue:d,hideBackdrop:l=!1,isError:u,name:c,onChange:h,onFilterChange:O,onOpenChange:p,open:x,placeholder:g,readOnly:C,renderValue:N,value:w,...E},K){const R=re(),{inputProps:v,fieldProps:L,useField:z}=we(E),[U,V]=r.useState(""),[k,Y]=r.useState(void 0),P=`${v.id}-listbox`,b=Z({value:d,onChange:f=>{O?.(f),!_&&f.target.value&&A(!0)}},{selector:f=>f.target.value}),ee=f=>{setTimeout(()=>{h&&h(f)})},y=Z({value:w,onChange:ee,defaultValue:t},{onChangeKey:"onChange",valueKey:"value",defaultValueKey:"defaultValue",selector:f=>f.target.selectedOptions.map(j=>j.value)}),S=Z({open:x,onOpenChange:p,initialOpen:s??!1},{defaultValueKey:"initialOpen",valueKey:"open",onChangeKey:"onOpenChange",selector:f=>f}),_=!!S.value,A=S.onChange,q=r.useRef(null),B=r.useRef(null),T=r.useRef(null);r.useEffect(()=>{if(q.current&&!w){const f=Array.from(q.current.selectedOptions).map(j=>j.value);f.length>0&&JSON.stringify(f)!==JSON.stringify(y.value)&&y.onChange(X({name:c,values:f}))}},[]);const le=r.useCallback(f=>{if(f){const j=f.getAttribute("id");j&&V(j)}},[]),D=r.useRef(new dt({name:c,getAllItems:je,getSelectedItems:Fe,isOpen:_,onOpenChange:f=>{A(f)},onChange:le,onSelect:f=>{y.onChange(f),ee(f),b.onChange({target:{value:""}})}}));B.current&&D.current.setListbox(B.current),T.current&&D.current.setElement(T.current),r.useEffect(()=>{D.current.setIsIOpen(_),_||b.onChange({target:{value:""}})},[_,b]),r.useEffect(()=>{_&&B.current&&(y.value===void 0?D.current.focusOnFirst():D.current.focusOnFirstSelected())},[_]),r.useEffect(()=>{D.current.setValue(y.value)},[y.value]),r.useEffect(()=>{setTimeout(()=>{if(b.value){const j=document.querySelector('[role="listbox"]')?.querySelectorAll('button[data-option]:not([aria-hidden="true"])');Y(j?.length)}else Y(void 0)})},[b.value]),r.useEffect(()=>{const f=setTimeout(()=>{D.current.resetFocus(),D.current.focusOnFirstSelected()},0);return()=>{clearTimeout(f)}},[b.value]);const H=r.useCallback((f,j,G)=>N?N(f,j,G):i.jsxs($e,{"data-class":"tag-groups",children:[f.map(M=>{const ue=Xe(j,M);return i.jsx(Ge,{size:"s",text:ue,"data-testid":n?`${n}.combobox.tag.${M}`:`combobox.tag.${M}`,onRemove:!o&&!C?()=>{y.onChange(X({name:c,value:M,values:f,action:"remove"}))}:void 0},M)}),G]}),[o,C,N]),ie=r.useMemo(()=>({queryFilter:b.value||"",value:y.value}),[b.value,y.value]),m=i.jsxs(W.Provider,{value:ie,children:[e,!!b.value&&k===0&&i.jsx("div",{role:"status",className:I.classNames("p-m","font-label-s","text-weak"),"aria-live":"polite",children:R("select.dropdown.no-results.message")})]}),$=r.useMemo(()=>Ct(e),[e]),te=Oe([q,K]),ne=i.jsxs(i.Fragment,{children:[i.jsx("span",{className:I.sr_only,children:i.jsx("select",{multiple:!0,defaultValue:t,value:t?void 0:y.value,onChange:yt,name:c,ref:te,tabIndex:-1,"aria-hidden":"true",className:I.hidden,children:$.map(f=>i.jsx("option",{value:f,tabIndex:-1,children:f},f))})}),i.jsx(bt,{...v,renderValues:H,values:y.value,hasError:u||v.hasError,placeholder:y.value?.length?void 0:g,role:"combobox","aria-autocomplete":"list","aria-activedescendant":U,"aria-controls":P,value:b.value||"",onChange:b.onChange,autoComplete:"off",disabled:o,readOnly:C,ref:T,onClick:()=>{_||A(!0)},onFocus:()=>{_||A(!0)},onKeyDownCapture:D.current.onKeyDownHandler,onClear:y.value?.length?()=>{y.onChange(X({name:c,values:[]}))}:void 0,"data-testid":n?`${n}.combobox`:"combobox","aria-expanded":_?"true":"false",children:m}),i.jsx(Se,{disableScrollLock:a,hideBackdrop:l,ref:B,className:pe.menu,role:"listbox",initialOpen:s,open:_,onOpenChange:A,anchorEl:T.current||void 0,forceMount:!0,minWidth:"reference",minHeight:100,placementUpdate:"dropdown",maxWidth:"s",tabIndex:-1,"data-testid":n?`${n}.listbox`:"listbox",onMouseDown:f=>{if(f.button===0){f.preventDefault(),f.stopPropagation();const G=f.target.closest("button[data-option]");if(G){const M=G.dataset.option,ue=G.getAttribute("aria-selected")==="true";y.onChange(X({name:c,value:M,values:y.value,action:ue?"remove":"add"})),b.onChange({target:{value:""}})}}},"aria-labelledby":v.id,id:P,content:m})]});return z?i.jsx(Ee,{...L,isError:u||v.hasError,children:ne}):ne}Ke.displayName="MultiSelect";const me=r.forwardRef(Le),vt=Ve;function Le({id:n,selectable:e,...s},t){const o=Ae(n),[a,d]=r.useState(!0),l=r.useContext(W),{value:u,children:c,...h}=s,O=nt(l,u);return i.jsx("button",{type:"button",id:o,ref:p=>{if(t&&(typeof t=="function"?t(p):t.current=p),p&&l.queryFilter){const g=(p.textContent||"").toLowerCase().includes(l.queryFilter.toLowerCase());g&&!a?d(!0):!g&&a&&d(!1)}else!l.queryFilter&&!a&&d(!0)},className:I.classNames("cursor-pointer","bg-transparent","font-label-s","text-default","flex-noreset","w-full","border-none","radius-subtle","m-0","p-0","outline-none",pe.menuitem),role:"option",style:{minInlineSize:"120px"},tabIndex:-1,"aria-selected":O?"true":"false","aria-hidden":!a,"data-option":u,...h,children:i.jsx(he.Content,{selectable:e===void 0?!0:e,selected:O,children:c})})}Le.displayName="Option";me.displayName="forwardRef(Option)";function It({label:n,isValid:e,...s}){const o=re()("select.createoption.label"),[a,d]=r.useState(!1),l=r.useContext(W),u=l.queryFilter||"";return r.useEffect(()=>{const c=e?e(u):!0;d(c&&u.length>=2)},[u]),a?i.jsx(me,{...s,selectable:!1,"data-create":"true",value:l.queryFilter,children:i.jsxs("div",{className:ce("flex-noreset","items-center","gap-m"),children:[i.jsx(We,{}),i.jsx("span",{className:ce("truncate"),title:l.queryFilter||"",children:`${n||o} ${(l.queryFilter||"").trim()}`}),i.jsx("span",{})]})}):null}function Be(){return r.useContext(W).queryFilter?null:i.jsx(he.Divider,{})}Be.displayName="Divider";const St=r.forwardRef(Me);function Me({children:n,...e},s){return n?i.jsx(he.Group,{...e,ref:s,children:n}):null}Me.displayName="OptGroup";const $t={Select:ft,Multi:Ot,Search:ae,Option:me,OptionStyled:vt,OptionCreate:It,OptGroup:St,Divider:Be};export{$t as S,Xe as a,fe as b,de as g};
