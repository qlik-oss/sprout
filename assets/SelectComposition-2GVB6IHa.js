import{r,j as l}from"./iframe-D-N3fK2j.js";import{u as ee}from"./useControl-U-WkQj2I.js";import{K as F,m as pe,a as Ve,M as he}from"./Menu-CpWAuarv.js";import{g as oe,P as re}from"./list-B1zo5gaH.js";import{m as Oe}from"./renderOrClone-25h2pNOO.js";import{c as W}from"./classNames-CrSIhzis.js";import{u as ae}from"./useI18n-ClHBar3-.js";import{s as A}from"./sprout-UDo5dA_z.js";import{F as ve}from"./Error-CZbJtLWx.js";import{D as Ie}from"./icons-BEmnCRju.js";import{F as Se,T as qe}from"./Tooltip-DaX3jRge.js";import{I as He}from"./InputButton-BoVH_no0.js";import{T as $e}from"./TagGroup-7XjF8tBf.js";import{T as Ge}from"./Tag-CLp8bTu7.js";import{u as we}from"./useFieldProps-Cnz6GbX_.js";import{F as Ee}from"./Field-DHjy_kFd.js";import{F as We}from"./Add-DHz0bRTt.js";import{u as Ae}from"./useId-Bkl3iN6O.js";import{T as ze}from"./TextField-DMygpcri.js";const Q="data-hovered";class Ne{isOpen;onOpenChange;onChange;element;name;value;listbox;getAllItems;_getAllItems;getSelectedItems;_getSelectedItems;loop;onSelect;constructor(e){this.isOpen=e.isOpen,this.name=e.name,this.value=e.value,this.onOpenChange=e.onOpenChange,this.onChange=e.onChange,this.getAllItems=e.getAllItems,this.getSelectedItems=e.getSelectedItems,this.loop=e.loop===void 0?!0:e.loop,this._getSelectedItems=()=>this.listbox&&this.getSelectedItems?this.getSelectedItems(this.listbox):oe(),this._getAllItems=()=>this.listbox?this.getAllItems(this.listbox):oe(),this.onSelect=e.onSelect,this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}setElement(e){this.element=void 0,e&&(this.element=e)}setListbox(e){this.listbox=void 0,e&&(this.listbox=e)}setIsIOpen(e){this.isOpen=e}setValue(e){this.value=e}getListInfo(){const e={selected:oe(),all:oe(),focus:void 0,focusIndex:-1,lastIndex:-1};if(!this.element)return e;e.all=this._getAllItems(),e.selected=this._getSelectedItems(),e.lastIndex=e.all.length-1;const s=e.all.values();let t,o=-1;do{const{value:a,done:d}=s.next();o+=1,t=!d,a&&(a.getAttribute(Q)==="true"?(e.focus=a,e.focusIndex=o):a.setAttribute(Q,"false"))}while(t);return e}focusOnNextItem(){const e=this.getListInfo();if(e.focusIndex===-1){this.focusOn(e,0);return}e.focusIndex===e.lastIndex?this.loop&&this.focusOn(e,0):typeof e.focusIndex=="number"&&this.focusOn(e,e.focusIndex+1)}focusOnPreviousItem(){const e=this.getListInfo();if(e.focusIndex===-1){this.focusOn(e,0);return}e.focusIndex===0?this.loop&&this.focusOn(e,e.lastIndex):this.focusOn(e,e.focusIndex-1)}focusOnNextPageItem(){const e=this.getListInfo();e.focusIndex+re>=e.lastIndex?this.focusOn(e,e.lastIndex):this.focusOn(e,e.focusIndex+re)}focusOnPreviousPageItem(){const e=this.getListInfo();e.focusIndex-re<0?this.focusOn(e,0):this.focusOn(e,e.focusIndex-re)}focusOnFirst(){const e=this.getListInfo();this.focusOn(e,0)}focusOnLast(){const e=this.getListInfo();this.focusOn(e,e.lastIndex)}resetFocus(){this._getAllItems().forEach(s=>{s.setAttribute(Q,"false")})}focusOn(e,s){if(s<0||s>e.lastIndex)return;const t=e.all[s];t&&(t.setAttribute(Q,"true"),Ue(t)||setTimeout(()=>{if(t.isConnected){const o=t.closest('[role="listbox"]');if(o){const a=t.getBoundingClientRect(),d=o.getBoundingClientRect(),i=a.top-d.top,u=a.bottom-d.top,c=d.height;let h=o.scrollTop;i<0?h+=i:u>c&&(h+=u-c),o.scroll({top:Math.max(0,h),behavior:"smooth"})}}},10),this.onChange(t),e.focusIndex!==-1&&e.focusIndex!==s&&e.all[e.focusIndex].setAttribute(Q,"false"),e.focusIndex=s)}focusOnFirstSelected(){const e=this.getListInfo(),s=e.selected[0];if(s){const t=Array.from(e.all).indexOf(s);this.focusOn(e,t)}else this.focusOn(e,0)}onKeyDownHandler(e){switch(e.key){case F.TAB:this.isOpen&&this.onOpenChange(!1);break;case"Down":case F.DOWN:e.stopPropagation(),e.preventDefault(),this.isOpen?this.focusOnNextItem():this.onOpenChange(!0);break;case"Up":case F.UP:e.stopPropagation(),e.preventDefault(),this.focusOnPreviousItem();break;case F.HOME:e.stopPropagation(),e.preventDefault(),this.focusOnFirst();break;case F.END:e.stopPropagation(),e.preventDefault(),this.focusOnLast();break;case F.PAGE_DOWN:e.stopPropagation(),e.preventDefault(),this.focusOnNextPageItem();break;case F.PAGE_UP:e.stopPropagation(),e.preventDefault(),this.focusOnPreviousPageItem();break}}}function Ue(n){const e=n.closest('[role="listbox"]');if(!e)return!0;const s=n.getBoundingClientRect(),t=e.getBoundingClientRect(),o=s.top-t.top,a=s.bottom-t.top;return o>=0&&a<=t.height}class Ye extends Ne{constructor(e){super(e),this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}onKeyDownHandler(e){switch(e.key){case F.ENTER:{if(e.stopPropagation(),e.preventDefault(),!this.isOpen)this.onOpenChange(!0);else{const t=this.getListInfo().focus;if(t){const o={type:"change",target:{type:"select-one",name:this.name,value:t.dataset.option}};this.onSelect?.(o)}this.onOpenChange(!1),this.element?.focus()}break}case F.ESCAPE:if(this.isOpen)e.stopPropagation(),this.onOpenChange(!1),this.element?.focus();else if(this.value){const s={type:"change",target:{type:"select-one",name:this.name,value:this.value}};this.onSelect?.(s)}break}super.onKeyDownHandler(e)}}function Je(n,e){const s=document.documentElement,o=window.getComputedStyle(s).getPropertyValue(n);if(o)return o.replace(/['"]/g,"").trim()}function Qe(n,e){const s=Je(n);if(s===void 0)return;const t=parseInt(s,10);return Number.isNaN(t)?void 0:t}function _e(n){if(!n)return n;const e=n.lastIndexOf("(");if(e===-1)return n;const s=n.slice(e+1),t=s.indexOf(")");return t!==-1?s.slice(0,t):s}function fe(n,e){if(!n)return{};let s=n;return Array.isArray(n)||(s=[n]),s.reduce((t,o)=>{if(t.value||!o||typeof o!="object")return t;if(Array.isArray(o))return{...fe(o,e),...t};if(!o.props)return t;if(_e(o.type.displayName)!=="Option"){if(o.props.children){const a=fe(o.props.children,e);if(a.value!==void 0)return a}}else if(e===o.props.value||!e&&o.props.value==="")return o.props;return t},{})}function de(n,e){if(!n)return{};let s=n;return Array.isArray(n)||(s=[n]),s.reduce((t,o)=>{if(!o||typeof o!="object")return t;if(Array.isArray(o))return{...de(o,e),...t};if(!o.props)return t;if(_e(o.type.displayName)!=="Option"){if(o.props.children)return{...de(o.props.children,e),...t}}else e?.includes(o.props.value||"")&&(t[o.props.value||""]=o.props);return t},{})}function Xe(n,e){let s=e;const t=n[e]?.children;switch(typeof t){case"string":s=t;break;case"object":s=t.props.label;break;default:s=e;break}return s}const Ze="_input_njiq0_1",et="_small_njiq0_7",ge={input:Ze,small:et},tt=r.forwardRef(De);function De({size:n,hasError:e,readOnly:s,isOpen:t,"aria-controls":o,placeholder:a,disabled:d,value:i,onClick:u,renderValue:c,children:h,...O},p){const[x,g]=r.useState({children:""});return r.useEffect(()=>{const C=fe(h,i);C&&g(C)},[h]),l.jsxs("button",{role:"combobox",type:"button",...O,"aria-readonly":s?"true":"false",disabled:d,"aria-controls":o,"aria-expanded":t?"true":"false",ref:p,className:A.classNames("flex-noreset","border-box","w-full","m-0","text-start","gap-m","justify-start","border-moderate","radius-pill","outline-focus-visible-centered",ge.input,{[ge.small]:n==="small","cursor-pointer":!d,"cursor-not-allowed":!!d,border_error:!!e,"bg-interactive":!s&&!t,"bg-disabled":!!s,"bg-pressed":!!t}),onClick:C=>{if(!d&&!s&&u&&u(C),s){const N=C.currentTarget.querySelector('[data-testid="selected-value"]');if(N){const S=document.createRange(),w=window.getSelection();w&&(w.removeAllRanges(),S.selectNodeContents(N),w.addRange(S))}}},children:[!!i&&!!c&&l.jsx("span",{"data-testid":"selected-value",className:A.classNames("flex-1","border-box","truncate","pr-m","w-full","text-default","font-label-s","pointer-events-none"),children:c(i,x)}),!!i&&!c&&l.jsx("div",{"data-testid":"selected-value",className:A.classNames("overflow-hidden","w-full","truncate","text-default","font-label-s"),children:x.children}),!i&&l.jsx("span",{className:A.classNames("flex-noreset","pr-m","text-weak","font-label-s","w-full"),children:a}),!!e&&l.jsx(ve,{"data-icon":"error",width:void 0,height:void 0,className:A.classNames("shrink-0","text-danger","self-center",{"size-xl":n!=="small","size-l":n==="small"})}),l.jsx(Ie,{className:A.classNames("fill-default","shrink-0","self-center",{"fill-disabled":!!d||!!s})})]})}De.displayName="Combobox";const z=r.createContext({}),nt=(n,e)=>e===void 0||!n?!1:Array.isArray(n.value)?n.value.includes(e):n.value===e;function ie(){const n=ae(),{queryFilter:e,setQueryFilter:s,open:t,onKeyDownCapture:o}=r.useContext(z),a=r.useRef(null),[d,i]=r.useState(void 0);return r.useEffect(()=>{t&&setTimeout(()=>{a.current&&a.current.focus()})},[t]),r.useEffect(()=>{setTimeout(()=>{if(e){const c=document.querySelector('[role="listbox"]')?.querySelectorAll('button[data-option]:not([aria-hidden="true"])');i(c?.length)}else i(void 0)})},[e]),l.jsxs(l.Fragment,{children:[l.jsx("span",{className:A.classNames("mb-s"),children:l.jsx(ze,{ref:a,type:"search",role:"searchbox",placeholder:n("select.dropdown.search.placeholder"),value:e,onChange:u=>s?.(u.target.value),onKeyDownCapture:o})}),!!e&&d===0&&l.jsx("div",{role:"status",className:A.classNames("p-m","font-label-s","text-weak"),"aria-live":"polite",children:n("select.dropdown.no-results.message")})]})}ie.displayName="SelectSearch";const st='button[data-option]:not([disabled]):not([aria-hidden="true"])',ot='button[aria-selected="true"]:not([disabled]):not([aria-hidden="true"])';function je(n){return n.querySelectorAll(st)}function Fe(n){return n.querySelectorAll(ot)}const Z=({name:n,value:e,values:s,action:t})=>{const o={type:"change",target:{name:n,value:e,type:"select-multiple",selectedOptions:(s||[]).map(a=>({value:a}))}};return t==="add"&&e?(s||[]).find(a=>a===e)||(o.target.selectedOptions=o.target.selectedOptions?.concat({value:e})):t==="remove"&&(o.target.selectedOptions=o.target.selectedOptions?.filter(a=>a.value!==e)),o},rt=500,xe=new WeakMap;function be(n){let e=xe.get(n);return e||(e={buffer:"",timerId:null,selectedValue:null},xe.set(n,e)),e}function Re(n){n.timerId!==null&&typeof window<"u"&&(window.clearTimeout(n.timerId),n.timerId=null)}function at(n){Re(n),!(typeof window>"u")&&(n.timerId=window.setTimeout(()=>{n.buffer="",n.timerId=null,n.selectedValue=null},rt))}function ye(n,e,s){if(!e||n.length===0)return-1;const t=n.length;if(typeof s>"u"||s<0){for(let o=0;o<t;o++)if(n[o].startsWith(e))return o;return-1}for(let o=1;o<=t;o++){const a=(s+o)%t;if(n[a].startsWith(e))return a}return-1}function Ce(n,e,s){const t=n.length;if(!t||!e)return-1;let o=-1,a=null,d=-1,i=null;const u=c=>{const h=n[c].charAt(0);h&&((a===null||h<a)&&(a=h,o=c),h>=e&&(i===null||h<i)&&(i=h,d=c))};if(typeof s>"u"||s<0)for(let c=0;c<t;c++)u(c);else for(let c=1;c<=t;c++)u((s+c)%t);return d!==-1?d:o}function it(n){r.useEffect(()=>()=>{s(n)},[]);const e=({typedCharacter:t,open:o,onChange:a,name:d})=>{const i=n.current;if(!i)return;const u=be(i),c=t.toLowerCase();u.buffer+=c,at(u);const h=Array.from(i._getAllItems());if(!h.length)return;const O=h.length,p=h.map(w=>w.textContent.trim().toLowerCase()),x=u.buffer;if(!x||!O)return;if(!o){const w=ye(p,x);if(w!==-1){u.selectedValue=h[w].getAttribute("data-option");const v={type:"change",target:{type:"select-one",name:d,value:u.selectedValue||"",selectedOptions:[]}};a(v);return}const K=Ce(p,x[0]);u.selectedValue=K!==-1?h[K].getAttribute("data-option"):null;const R={type:"change",target:{type:"select-one",name:d,value:u.selectedValue||"",selectedOptions:[]}};a(R);return}const g=i.getListInfo();if(!g)return;const C=g.focusIndex,N=ye(p,x,C);if(N!==-1){i.focusOn(g,N);return}const S=Ce(p,x[0],C);S!==-1&&i.focusOn(g,S)};function s(t){const o=t?.current;if(!o)return;const a=be(o);a.buffer="",Re(a)}return{onKeydown:e,resetTypeahead:s}}const lt=Qe("--sprout-common-spacing-xxl")||24,ut=r.forwardRef(ke);function ct(n){const[e,...s]=r.Children.toArray(n);return r.isValidElement(e)&&e.type===ie?l.jsxs(l.Fragment,{children:[e,l.jsx("div",{className:W("overflow-auto"),role:"listbox",tabIndex:-1,children:s})]}):n}function ke({children:n,defaultOpen:e,defaultValue:s,disabled:t,disableScrollLock:o,hasError:a,hideBackdrop:d,id:i,maxWidth:u,name:c,onChange:h,onOpenChange:O,open:p,placeholder:x,placementUpdate:g,readOnly:C,size:N,value:S,...w},K){const R=Ae(i),[v,L]=r.useState(!1),[U,Y]=r.useState(""),[V,k]=r.useState(""),J=`${R}-listbox`,P=r.useRef(null),b=r.useRef(null),te=r.useMemo(()=>{const[m]=r.Children.toArray(n);return r.isValidElement(m)&&m.type===ie},[n]),y=m=>{setTimeout(()=>{h&&h(m)})},I=ee({value:S,onChange:y,defaultValue:s},{selector:m=>m?.target?.value}),_=r.useCallback(m=>{if(m){const $=m.getAttribute("id");$&&Y($)}},[]),E=r.useRef(new Ye({name:c,getAllItems:je,getSelectedItems:Fe,isOpen:p,onOpenChange:O,onChange:_,onSelect:m=>{I.onChange(m),y(m)}}));r.useEffect(()=>{E.current.setIsIOpen(p),p||k(""),b.current&&p&&b.current.focus()},[p]),r.useEffect(()=>{p&&P.current&&(I.value===void 0?E.current.focusOnFirst():E.current.focusOnFirstSelected())},[p,P,I.value]),r.useEffect(()=>{E.current.setValue(I.value)},[I.value]);const{onKeydown:q,resetTypeahead:B}=it(E),T=r.useCallback(m=>{m.key.length===1&&!m.ctrlKey&&!m.metaKey&&!m.altKey&&m.key!==" "&&q({typedCharacter:m.key,open:p,onChange:I.onChange}),E.current.onKeyDownHandler(m),B()},[p,q,B,I.onChange]),le=r.useMemo(()=>({queryFilter:V||"",setQueryFilter:k,value:I.value,open:p,onKeyDownCapture:T}),[I.value,V,k,p,T]),D=l.jsx(z.Provider,{value:le,children:ct(n)});P.current&&E.current.setListbox(P.current),b.current&&E.current.setElement(b.current);const H=r.useRef(null),ue=Oe([H,K]);return r.useEffect(()=>{const m=H.current?.value;s===void 0&&S===void 0&&m&&I.onChange({type:"change",target:H.current})},[s,S,H]),l.jsxs(l.Fragment,{children:[l.jsx("input",{type:"hidden",defaultValue:s,value:s?void 0:I.value,name:c,ref:ue}),l.jsx(Se,{disableScrollLock:o,hideBackdrop:d,initialOpen:e,open:v?p:!1,onOpenChange:O,anchorEl:b.current||void 0,forceMount:!0,onMount:()=>{L(!0)},minWidth:"reference",maxWidth:u||"s",minHeight:100,viewportPadding:lt,placementUpdate:g===void 0?"dropdown":g,id:J,className:pe.menu,"aria-labelledby":R,ref:P,role:te?void 0:"listbox",tabIndex:-1,onClick:m=>{const ne=m.target.closest("button[data-option]");if(!ne)return;O(!1);const se={type:"change",target:{type:"select-one",name:c,value:ne.dataset.option}};I.onChange(se)},content:D}),l.jsx(tt,{...w,hasError:a,"aria-activedescendant":U,placeholder:x,isOpen:p,size:N,value:I.value,id:R,"aria-controls":J,disabled:t,readOnly:C,ref:b,onClick:()=>{O(!p)},onKeyDownCapture:T,children:D})]})}ke.displayName="SelectFloating";const ft=r.forwardRef(Pe);function Pe({isError:n,defaultOpen:e,disableScrollLock:s,hideBackdrop:t,selectedValueDisplay:o="full",...a},d){const[i,u]=r.useState(!!e),{fieldProps:c,inputProps:h,useField:O}=we(a);let p=l.jsx(ut,{"data-selected-value-display":o,ref:d,disableScrollLock:s,hideBackdrop:t,...h,hasError:n||h.hasError,defaultOpen:e,open:i,onOpenChange:u});return O&&(p=l.jsx(Ee,{...c,isError:n||h.hasError,onKeyDownCapture:x=>{const g=x.key===F.TAB,C=x.shiftKey&&g;(g||C)&&i&&u(!1)},children:p})),p}Pe.displayName="Select";class dt extends Ne{constructor(e){super(e),this.onKeyDownHandler=this.onKeyDownHandler.bind(this)}onKeyDownHandler(e){switch(e.key){case F.ENTER:{e.stopPropagation(),e.preventDefault();const t=this.getListInfo().focus;if(t){const o=t.dataset.option,a=t.getAttribute("aria-selected")==="true",d=Z({name:this.name,value:o,values:this.value,action:a?"remove":"add"});this.onSelect?.(d)}break}}super.onKeyDownHandler(e)}}const pt="_input_175ug_1",ht="_input_disabled_175ug_20",mt="_input_error_175ug_26",gt="_input_readonly_175ug_43",xt="_search_input_175ug_49",X={input:pt,input_disabled:ht,input_error:mt,input_readonly:gt,search_input:xt},bt=r.forwardRef(Te);function Te(n,e){const{id:s,type:t,values:o,renderValues:a,children:d,disabled:i,readOnly:u,hasError:c,value:h,onChange:O,defaultValue:p,onClear:x,labelClear:g,"data-testid":C,"aria-labelledby":N,"aria-label":S,...w}=n,R=ae()("select.comboboxeditable.clear"),v=r.useRef(null),L=ee({value:h,onChange:O,defaultValue:p},{onChangeKey:"onChange",valueKey:"value",defaultValueKey:"defaultValue",selector:k=>k.target.value}),[U,Y]=r.useState({});r.useEffect(()=>{const k=de(d,o);Y(k)},[d,o]);const V=!u&&o||!o?l.jsx("input",{...w,"aria-label":S,id:s,value:L.value,onChange:L.onChange,type:t||"text",disabled:i||u,readOnly:u,className:A.classNames("relative","flex-noreset","flex-1","border-none","bg-transparent","text-default","font-label-s","py-s","px-xs","outline-none",X.search_input,{"cursor-text":!i,"cursor-not-allowed":!!i}),ref:v}):null;return l.jsxs("div",{className:A.classNames("border-box","box-shadow-transparent","flex-noreset","flex-row","items-center","justify-stretch","w-full","relative","border-moderate","radius-pill","bg-default","overflow-hidden",X.input,{[X.input_error]:!!c,[X.input_readonly]:!!u,[X.input_disabled]:!!i}),"data-testid":C,ref:e,onClick:()=>{v.current&&v.current.focus()},children:[l.jsx("button",{type:"button",className:A.classNames("absolute","bg-transparent","outline-none","border-none","w-full","h-full","p-0","m-0","left-0","top-0",{"cursor-pointer":!i,"cursor-not-allowed":!!i}),onClick:()=>{i||u||v.current&&v.current.focus()},"aria-labelledby":N,"aria-label":S}),a(o||[],U,V),!!x&&!u&&!i&&l.jsx(qe,{title:g||R,children:l.jsx(He,{"data-clear":"true",id:`${s}-clear`,onClick:()=>{L.onChange({target:{value:""}}),x(),v.current&&v.current.focus()},"aria-label":g||R,size:"s"})}),!!c&&l.jsx(ve,{width:void 0,height:void 0,className:A.classNames("self-center","size-xl","shrink-0","mr-m","text-danger")}),l.jsx(Ie,{className:A.classNames("fill-default","shrink-0","self-center",{"fill-disabled":!!i||!!u})})]})}Te.displayName="ComboboxEditable";const yt=()=>{},Ct=n=>{const e=[],s=t=>{r.isValidElement(t)&&(t.props&&typeof t.props=="object"&&"value"in t.props&&typeof t.props.value=="string"&&e.push(t.props.value),t.props&&typeof t.props=="object"&&"children"in t.props&&t.props.children&&(typeof t.props.children=="string"||typeof t.props.children=="number"||typeof t.props.children=="boolean"||Array.isArray(t.props.children)||r.isValidElement(t.props.children))&&r.Children.forEach(t.props.children,s))};return r.Children.forEach(n,s),e},Ot=r.forwardRef(Ke);function Ke({"data-testid":n,children:e,defaultOpen:s,defaultValue:t,disabled:o,disableScrollLock:a=!1,filterValue:d,hideBackdrop:i=!1,isError:u,name:c,onChange:h,onFilterChange:O,onOpenChange:p,open:x,placeholder:g,readOnly:C,renderValue:N,value:S,...w},K){const R=ae(),{inputProps:v,fieldProps:L,useField:U}=we(w),[Y,V]=r.useState(""),[k,J]=r.useState(void 0),P=`${v.id}-listbox`,b=ee({value:d,onChange:f=>{O?.(f),!_&&f.target.value&&E(!0)}},{selector:f=>f.target.value}),te=f=>{setTimeout(()=>{h&&h(f)})},y=ee({value:S,onChange:te,defaultValue:t},{onChangeKey:"onChange",valueKey:"value",defaultValueKey:"defaultValue",selector:f=>f.target.selectedOptions.map(j=>j.value)}),I=ee({open:x,onOpenChange:p,initialOpen:s??!1},{defaultValueKey:"initialOpen",valueKey:"open",onChangeKey:"onOpenChange",selector:f=>f}),_=!!I.value,E=I.onChange,q=r.useRef(null),B=r.useRef(null),T=r.useRef(null);r.useEffect(()=>{if(q.current&&!S){const f=Array.from(q.current.selectedOptions).map(j=>j.value);f.length>0&&JSON.stringify(f)!==JSON.stringify(y.value)&&y.onChange(Z({name:c,values:f}))}},[]);const le=r.useCallback(f=>{if(f){const j=f.getAttribute("id");j&&V(j)}},[]),D=r.useRef(new dt({name:c,getAllItems:je,getSelectedItems:Fe,isOpen:_,onOpenChange:f=>{E(f)},onChange:le,onSelect:f=>{y.onChange(f),te(f),b.onChange({target:{value:""}})}}));B.current&&D.current.setListbox(B.current),T.current&&D.current.setElement(T.current),r.useEffect(()=>{D.current.setIsIOpen(_),_||b.onChange({target:{value:""}})},[_,b]),r.useEffect(()=>{_&&B.current&&(y.value===void 0?D.current.focusOnFirst():D.current.focusOnFirstSelected())},[_]),r.useEffect(()=>{D.current.setValue(y.value)},[y.value]),r.useEffect(()=>{setTimeout(()=>{if(b.value){const j=document.querySelector('[role="listbox"]')?.querySelectorAll('button[data-option]:not([aria-hidden="true"])');J(j?.length)}else J(void 0)})},[b.value]),r.useEffect(()=>{const f=setTimeout(()=>{D.current.resetFocus(),D.current.focusOnFirstSelected()},0);return()=>{clearTimeout(f)}},[b.value]);const H=r.useCallback((f,j,G)=>N?N(f,j,G):l.jsxs($e,{"data-class":"tag-groups",children:[f.map(M=>{const ce=Xe(j,M);return l.jsx(Ge,{size:"s",text:ce,"data-testid":n?`${n}.combobox.tag.${M}`:`combobox.tag.${M}`,onRemove:!o&&!C?()=>{y.onChange(Z({name:c,value:M,values:f,action:"remove"}))}:void 0},M)}),G]}),[o,C,N]),ue=r.useMemo(()=>({queryFilter:b.value||"",value:y.value}),[b.value,y.value]),m=l.jsxs(z.Provider,{value:ue,children:[e,!!b.value&&k===0&&l.jsx("div",{role:"status",className:W("p-m","font-label-s","text-weak"),"aria-live":"polite",children:R("select.dropdown.no-results.message")})]}),$=r.useMemo(()=>Ct(e),[e]),ne=Oe([q,K]),se=l.jsxs(l.Fragment,{children:[l.jsx("span",{className:W("sr-only"),children:l.jsx("select",{multiple:!0,defaultValue:t,value:t?void 0:y.value,onChange:yt,name:c,ref:ne,tabIndex:-1,"aria-hidden":"true",className:W("hidden"),children:$.map(f=>l.jsx("option",{value:f,tabIndex:-1,children:f},f))})}),l.jsx(bt,{...v,renderValues:H,values:y.value,hasError:u||v.hasError,placeholder:y.value?.length?void 0:g,role:"combobox","aria-autocomplete":"list","aria-activedescendant":Y,"aria-controls":P,value:b.value||"",onChange:b.onChange,autoComplete:"off",disabled:o,readOnly:C,ref:T,onClick:()=>{_||E(!0)},onFocus:()=>{_||E(!0)},onKeyDownCapture:D.current.onKeyDownHandler,onClear:y.value?.length?()=>{y.onChange(Z({name:c,values:[]}))}:void 0,"data-testid":n?`${n}.combobox`:"combobox","aria-expanded":_?"true":"false",children:m}),l.jsx(Se,{disableScrollLock:a,hideBackdrop:i,ref:B,className:pe.menu,role:"listbox",initialOpen:s,open:_,onOpenChange:E,anchorEl:T.current||void 0,forceMount:!0,minWidth:"reference",minHeight:100,placementUpdate:"dropdown",maxWidth:"s",tabIndex:-1,"data-testid":n?`${n}.listbox`:"listbox",onMouseDown:f=>{if(f.button===0){f.preventDefault(),f.stopPropagation();const G=f.target.closest("button[data-option]");if(G){const M=G.dataset.option,ce=G.getAttribute("aria-selected")==="true";y.onChange(Z({name:c,value:M,values:y.value,action:ce?"remove":"add"})),b.onChange({target:{value:""}})}}},"aria-labelledby":v.id,id:P,content:m})]});return U?l.jsx(Ee,{...L,isError:u||v.hasError,children:se}):se}Ke.displayName="MultiSelect";const me=r.forwardRef(Le),vt=Ve;function Le({id:n,selectable:e,...s},t){const o=Ae(n),[a,d]=r.useState(!0),i=r.useContext(z),{value:u,children:c,...h}=s,O=nt(i,u);return l.jsx("button",{type:"button",id:o,ref:p=>{if(t&&(typeof t=="function"?t(p):t.current=p),p&&i.queryFilter){const g=(p.textContent||"").toLowerCase().includes(i.queryFilter.toLowerCase());g&&!a?d(!0):!g&&a&&d(!1)}else!i.queryFilter&&!a&&d(!0)},className:A.classNames("cursor-pointer","bg-transparent","font-label-s","text-default","flex-noreset","w-full","border-none","radius-subtle","m-0","p-0","outline-none",pe.menuitem),role:"option",style:{minInlineSize:"120px"},tabIndex:-1,"aria-selected":O?"true":"false","aria-hidden":!a,"data-option":u,...h,children:l.jsx(he.Content,{selectable:e===void 0?!0:e,selected:O,children:c})})}Le.displayName="Option";me.displayName="forwardRef(Option)";function It({label:n,isValid:e,...s}){const o=ae()("select.createoption.label"),[a,d]=r.useState(!1),i=r.useContext(z),u=i.queryFilter||"";return r.useEffect(()=>{const c=e?e(u):!0;d(c&&u.length>=2)},[u]),a?l.jsx(me,{...s,selectable:!1,"data-create":"true",value:i.queryFilter,children:l.jsxs("div",{className:W("flex-noreset","items-center","gap-m"),children:[l.jsx(We,{}),l.jsx("span",{className:W("truncate"),title:i.queryFilter||"",children:`${n||o} ${(i.queryFilter||"").trim()}`}),l.jsx("span",{})]})}):null}function Be(){return r.useContext(z).queryFilter?null:l.jsx(he.Divider,{})}Be.displayName="Divider";const St=r.forwardRef(Me);function Me({children:n,...e},s){return n?l.jsx(he.Group,{...e,ref:s,children:n}):null}Me.displayName="OptGroup";const $t={Select:ft,Multi:Ot,Search:ie,Option:me,OptionStyled:vt,OptionCreate:It,OptGroup:St,Divider:Be};export{$t as S,Xe as a,fe as b,de as g};
